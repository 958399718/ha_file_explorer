<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />

    <link href="https://cdn.bootcss.com/material-design-icons/3.0.1/iconfont/material-icons.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <style>
        .des {
            padding-top: 8px;
        }
        #app .collection {
            overflow: inherit !important;
        }
    </style>
</head>

<body>

    <div id="app" class="container">
        <ul class="collection with-header">
            <li class="collection-header">
                <h4>代码插件库开发版</h4>
            </li>
            <li class="collection-item avatar" v-for="(item, index) in list">
                <i class="material-icons teal circle">code</i>
                <span class="title">{{item.name}}</span>
                <p class="des">
                    <span class="chip">
                        {{item.domain}}
                    </span>
                    <a class="chip" :href="`https://github.com/shaonianzhentan/${item.domain}`" target="_blank">
                        https://github.com/shaonianzhentan/{{item.domain}}
                    </a>
                </p>
                <!--菜单-->
                <a href="#!" class='dropdown-trigger secondary-content' :data-target='`dropdown${index}`'>
                    <i class="material-icons">more_vert</i>
                </a>
                <ul :id='`dropdown${index}`' class='dropdown-content'>
                    <li @click="updateClick(item)"><a href="#!">拉取代码</a></li>
                    <li class="divider"></li>
                    <li @click="reloadClick(item)"><a href="#!">重新加载</a></li>
                </ul>
            </li>
        </ul>

        <div class="fixed-action-btn">
            <a :href="`index.html?ver=${ver}`" class="btn-floating btn-large red">
                <i class="large material-icons">home</i>
            </a>
        </div>


        <!-- loading -->
        <div v-show="loading" style="position: fixed;top:0;left:0;width:100%;height:100vh;
         background:rgba(0,0,0,.8);
         z-index:10000;
         padding-top:200px;
         text-align:center;">
            <div class="preloader-wrapper big active">
                <div class="spinner-layer spinner-blue">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="gap-patch">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>

                <div class="spinner-layer spinner-red">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="gap-patch">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>

                <div class="spinner-layer spinner-yellow">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="gap-patch">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>

                <div class="spinner-layer spinner-green">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="gap-patch">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>
            </div>
            <p style="color:white;">
                加载中...
            </p>
        </div>
    </div>
    <script src="ha.js"></script>

    <script src="https://cdn.bootcss.com/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
    <script>

        let app = new Vue({
            el: '#app',
            data() {
                return {
                    ver: ha.ver,
                    loading: false,
                    list: [
                        {
                            domain: 'ha_cloud_music',
                            name: '网易云音乐'
                        }, {
                            domain: 'ha_baidu_map',
                            name: '百度地图'
                        }, {
                            domain: 'ha_sidebar',
                            name: '侧边栏管理'
                        }, {
                            domain: 'ha_file_explorer',
                            name: '文件管理'
                        }, {
                            domain: 'ha_qqmail',
                            name: 'QQ邮箱通知'
                        }, {
                            domain: 'ha_shbus',
                            name: '上海公交'
                        }, {
                            domain: 'ha_voice',
                            name: '语音小助手'
                        }, {
                            domain: 'ha_ylui',
                            name: 'Web桌面'
                        }, {
                            domain: 'ha_ble_home',
                            name: '蓝牙在家'
                        }
                    ]
                }
            },
            created() {

            },
            mounted() {
            },
            methods: {
                toast(html) {
                    M.toast({ html })
                },
                updateClick(item) {
                    this.loading = true
                    ha.post({
                        type: 'update',
                        domain: item.domain
                    }).then(res => {
                        this.toast(res.msg)
                    }).finally(() => {
                        this.loading = false
                    })
                },
                reloadClick(item) {
                    this.loading = true
                    ha.post({
                        type: 'reload',
                        domain: item.domain
                    }).then(res => {
                        this.toast(res.msg)
                    }).finally(() => {
                        this.loading = false
                    })
                }
            }
        })


        M.AutoInit();
    </script>
</body>

</html>